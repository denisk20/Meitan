<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:sf="http://www.springframework.org/tags/faces"
                xmlns:c="http://java.sun.com/jstl/core"
                xmlns:j4j="http://javascript4jsf.dev.java.net/"
                template="/WEB-INF/templates/meitan.xhtml">
    <ui:define name="header">
        <sf:resource path="/styles/registration.css"/>
    </ui:define>
    <ui:define name="content">

        <h1>Регистрация нового клиента</h1>

        <div class="section">
            <h:messages/>
            <h:form id="registeringForm">
                <fieldset>
                    <legend>Ваши данные</legend>
                    <div class="field">
                        <div class="label">Имя</div>
                        <div class="input">
                            <sf:clientTextValidator promptMessage="Введите ваше имя">
                                <h:inputText id="firstName" value="#{newClient.name.firstName}"/>
                            </sf:clientTextValidator>
                        </div>
                    </div>

                    <div class="field">
                        <div class="label">Отчество</div>
                        <div class="input">
                            <sf:clientTextValidator promptMessage="Введите отчество">
                                <h:inputText id="patronymic" value="#{newClient.name.patronymic}"/>
                            </sf:clientTextValidator>
                        </div>
                    </div>


                    <div class="field">
                        <div class="label">Фамилия</div>
                        <div class="input">
                            <sf:clientTextValidator promptMessage="Введите фамилию">
                                <h:inputText id="secondName" value="#{newClient.name.secondName}"/>
                            </sf:clientTextValidator>
                        </div>
                    </div>

                    <div class="field">
                        <div class="field">
                            <div class="label">Почтовый ящик</div>
                            <!--todo this validator works only partially-->
                            <div class="input"><sf:clientTextValidator regExp="[a-zA-Z0-9._%-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}" required="true"
                                                                       promptMessage="Ваш электронный почтовый ящик"
                                                                       invalidMessage="Ваш ящик некорректен">
                                <h:inputText id="emailAddress" value="#{newClient.email}" required="true"/>
                            </sf:clientTextValidator>
                            </div>
                        </div>
                    </div>

                    <div class="field">
                        <div class="label">Пометки</div>
                        <div class="input">
                            <sf:clientTextValidator promptMessage="Дополнительные сведения о вас">
                                <h:inputText id="notes" value="#{newClient.notes}" />
                            </sf:clientTextValidator>
                        </div>
                    </div>

                    <div class="field">
                        <div class="label">Логин</div>
                        <div class="input">
                            <sf:clientTextValidator promptMessage="Введите ваш логин (запишите его!)">
                                <h:inputText id="login" value="#{newClient.login}"/>
                            </sf:clientTextValidator>
                        </div>
                    </div>


                    <div class="field">
                        <div class="label">Пароль</div>
                        <div class="input">
                            <sf:clientTextValidator promptMessage="Введите ваш пароль">
                                <h:inputSecret id="pass" value="#{newClient.password}">
                                    <j4j:idProxy id="origPass"/>
                                </h:inputSecret>
                            </sf:clientTextValidator>
                        </div>
                    </div>

                    <div class="field">
                        <div class="label">Повторите пароль</div>
                        <div class="input">
                            <sf:clientTextValidator promptMessage="Введите пароль ещё раз">
                                <h:inputSecret id="conformPass" value="#{newClient.conformedPassword}">
                                    <j4j:idProxy id="conformedPass"/>
                                </h:inputSecret>
                            </sf:clientTextValidator>
                        </div>
                    </div>
                </fieldset>


                    <!--todo replace this with the call of net.tanesha.recaptcha.ReCaptchaImpl.createRecaptchaHtml-->
                    <script type="text/javascript"
                            src="http://api.recaptcha.net/challenge?k=6LcTPLsSAAAAAGxZPlc-ho30s-GlcYREXPM3sAzx">
                    </script>
                    <noscript>
                        <iframe src="http://api.recaptcha.net/noscript?k=6LcTPLsSAAAAAGxZPlc-ho30s-GlcYREXPM3sAzx"
                                height="300" width="500" frameborder="0"></iframe>
                        <br/>
                        <textarea name="recaptcha_challenge_field" rows="3" cols="40">
                        </textarea>
                        <input type="hidden" name="recaptcha_response_field"
                               value="manual_challenge"/>
                    </noscript>

                    <script type="text/javascript">
                        /*
                         function validatePasswords() {
                         return false;
                         var passRealId=document.getElementById("origPass").title;
                         var confPassRealId=document.getElementById("conformedPass").title;

                         var passComponent = document.getElementById(passRealId);
                         var conformedPassComponent = document.getElementById(confPassRealId);

                         if(! (passComponent.value == conformedPassComponent.value)) {
                         alert("Passwords doesn't match");
                         return false;
                         }
                         return true;
                         }
                         */

                    </script>
                    <!--todo this doesn't work-->
                    <sf:commandButton value="Регистрация!" action="register" processIds="*"/>
                    <sf:commandButton value="Отмена" action="cancel"/>
            </h:form>
        </div>


    </ui:define>
</ui:composition>