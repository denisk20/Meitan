<?xml version="1.0" encoding="UTF-8"?>
<flow xmlns="http://www.springframework.org/schema/webflow"
	  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	  xsi:schemaLocation="http://www.springframework.org/schema/webflow http://www.springframework.org/schema/webflow/spring-webflow-2.0.xsd">

	<view-state id="aboutUs">
        <on-render>
            <evaluate expression="productDao.getNew()" result="viewScope.newProducts" result-type="dataModel"/>
        </on-render>

		<transition on="selectGood" to="good">
			<set name="flashScope.product" value="newProducts.selectedRow"/>
		</transition>
	</view-state>

	<view-state id="categories">
        <on-render>
            <evaluate expression="categoryDao.findAll()" result="viewScope.categories" result-type="dataModel"/>
        </on-render>

		<transition on="selectCategory" to="goodsListForCategory">
			<set name="flashScope.category" value="categories.selectedRow"/>
		</transition>
	</view-state>

	<view-state id="join">
	</view-state>

	<view-state id="goodsListForCategory">
		<on-render>
			<evaluate expression="productDao.getForCategory(flashScope.category.id)" result="viewScope.products" result-type="dataModel"/>
		</on-render>
		<transition on="selectGood" to="good">
			<set name="flashScope.product" value="products.selectedRow"/>
		</transition>
	</view-state>
	
	<view-state id="good">
		<!--<on-render>-->
			<!--<evaluate expression="productDao.getForCategory(flowScope.category.id)" result="viewScope.products" result-type="dataModel"/>-->
		<!--</on-render>-->
	</view-state>

	<view-state id="addCategory">
		<var name="newCategory" class="com.meitan.lubov.model.persistent.Category"/>
		<transition on="create" to="aboutUs">
			<evaluate expression="categoryDao.makePersistent(viewScope.newCategory)"/>
		</transition>

		<!--<transition on="upload">-->
			<!--<evaluate expression="fileUploadHandler.processFile('category', '12', flowRequestContext)"/>-->
		<!--</transition>-->
	</view-state>

	<end-state id="finish"/>

	<global-transitions>
		<transition on="viewGoods" to="categories"/>
		<transition on="about" to="aboutUs"/>
		<transition on="joinUs" to="join"/>
		<transition on="addCategory" to="addCategory"/>
	</global-transitions>
</flow>