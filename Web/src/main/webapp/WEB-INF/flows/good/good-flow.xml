<?xml version="1.0" encoding="UTF-8"?>
<flow xmlns="http://www.springframework.org/schema/webflow"
	  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	  xsi:schemaLocation="http://www.springframework.org/schema/webflow http://www.springframework.org/schema/webflow/spring-webflow-2.0.xsd"
		parent="global,baseGood,abstractEditable">

	<input name="id" required="true" type="long" />

	<on-start>
		<evaluate expression="productDao.findById(id)" result="flowScope.product"/>
        <evaluate expression="utils.asList(product.images)" result="flowScope.imagesList"/>
		
		<set name="flashScope.selectedImage" value="utils.asList(product.images).get(0)"/>

		<set name="flowScope.outState" value="'good'"/>
		<set name="flowScope.selectFlow" value="'good'"/>
		<set name="flowScope.editFlow" value="'editGood'"/>
		<set name="flowScope.className" value="'com.meitan.lubov.model.persistent.Product'"/>
		<set name="conversationScope.dao" value="productDao"/>

		<set name="flowScope.flowName" value="'good'"/>
		<set name="flowScope.afterDeleteFlowName" value="'viewGoods'"/>

	</on-start>
	<view-state id="good" parent="baseGood#baseGood">
        <!--todo how to unit test this?-->
        <transition on="hitImage">
            <set name="requestScope.imageId" value="requestParameters.id" type="long"/>
            <set name="flashScope.selectedImage" value="imageDao.findById(imageId)"/>
            <render fragments="bigPicture"/>
        </transition>
	</view-state>

	<end-state id="end"/>
</flow>